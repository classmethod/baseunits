// -*- coding: utf-8; mode: groovy -*-

buildscript {
	repositories {
		mavenCentral()
		maven { url "https://plugins.gradle.org/m2/" }
	}
	dependencies {
		classpath 'org.ajoberstar.grgit:grgit-gradle:3.1.1'
	}
}

ext {
	git = org.ajoberstar.grgit.Grgit.open(dir: file('.'))
	revision = git.head().abbreviatedId
}

version = LocalDateTime.now().format("yyyyMMdd") + "-" + revision +
		(git.branch.current.name != "master" ? "-SNAPSHOT" : "") +
		(git.status().isClean() ? "" : "+dirty")
if (System.getenv('CIRCLE_TAG') != null) {
	version = System.getenv('CIRCLE_TAG')
}

task showVersion {
	doLast {
		println version
	}
}
